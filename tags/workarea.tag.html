<workarea>
    <style>
        #work-canvas{
            position: absolute;
	        z-index: 1;
        }
        #canvas-container{
            height: calc(100vh - 150px);
            display: block;
            overflow: auto;
            position: relative;
        }
    </style>

    <div id="canvas-container">
        <img id="img" src={ opts.img.src } width="{ opts.img.size.width }" height="{ opts.img.size.height }"/>
        <div id="work-canvas" width="{ opts.img.size.width }" height="{ opts.img.size.height }"></div>
        <!-- <div id="img_overlay"></div> -->
        <span id="tooltip-span"></span>
        <div id="v_line"></div>
        <div id="h_line"></div>
    </div>

    <script>
        $(document).on('click', function(event){
            selectedLabels.forEach(el => {
                el.selectize(false);
            });
            selectedLabels = [];
        });

        $(document).keyup(function(e){
            if(e.keyCode == 46){
                selectedLabels.forEach(el => {
                    $("[for="+ el.node.id+"]").remove();
                    el.selectize(false).remove();
                });
                selectedLabels = [];
                //delete all the points related to a polygon
                //show snakebar to inform
            }else if(e.keyCode == 65){
                /* allLabels.forEach(el => {
                    el.remove();
                }); */
            }

            //if a label element is selected then on arrow key with combination of ctrl, alt, and shift whould move the element
        });
        
        this.on('mount',function() {

            myCanvas = new SVG('work-canvas').size(opts.img.size.width, opts.img.size.height);

            myCanvas.on('mousedown', function(event){
                //unselect all the labels
                selectedLabels.forEach(el => {
                    el.selectize(false);
                });
                selectedLabels = [];
                if(selectedTool && selectedTool.type !== "point" && !alreadyDrawing){
                    var currentTool = selectedTool.create(event,myCanvas);
                    currentTool.on('drawstart', function(){
                        alreadyDrawing = true;
                    });
                    currentTool.on('drawstop', function(){
                        alreadyDrawing = false;
                        console.log("drawing is stopped")
                        currentTool.on("click", function(e) {
                            if(selectedTool.type === "point"){
                                var point = selectedTool.create(e,myCanvas);
                                point.attr({
                                    for: currentTool.node.id
                                })
                                point.on("click", function(e) {
                                    if(!e.ctrlKey){
                                            //unselect all the points
                                            selectedLabels.forEach(el => {
                                                el.selectize(false);
                                            });
                                        }
                                        point.selectize({ rotationPoint: false});
                                        selectedLabels.push(point);
                                        e.stopPropagation();
                                    });
                            }else if(!e.ctrlKey){
                                //unselect all the labels
                                selectedLabels.forEach(el => {
                                    el.selectize(false);
                                });
                            }
                            currentTool.selectize({ rotationPoint: false});
                            selectedLabels.push(currentTool);
                            e.stopPropagation();
                        });
                    });
                    
                    if(selectedTool.resizable){
                        currentTool.draw(event);
                        selectedElement = currentTool;
                    }

                }

            
                // remove listener
            });
            myCanvas.on('mouseup', function(event){
                if(selectedTool && selectedElement)   selectedElement.draw(event);
            });
            
        } );
    </script>
</workarea>