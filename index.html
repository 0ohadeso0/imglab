<!DOCTYPE html>
<html>
<head>
	<title>ImgLab</title>
	<script src="js/thirdparty/jquery.min.js" ></script>
	<script src="js/Face++DataParser.js"></script>
	<script src="js/FaceBox.js"></script>
	<script src="js/face++api.js"></script>
	<script src="js/labels.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
	<script src="js/thirdparty/jsplumb.min.js"></script>
	<link rel="stylesheet" href="css/style.css">
	<link rel="stylesheet" href="css/jquery-confirm.min.css">
	<script src="js/thirdparty/jquery-confirm.min.js"></script>
	
</head>
<body>


<form>
	<input type="text" id="image_url" name="image_url" placeholder="URL">
    <input type="button" id="imgUrlBtn" value="GO" />
    Or
	<input type="file" id="image_file" value="Browse" onchange="readURL(this)" />
</form>

<div>
	<input type="text" name="api_key" id="api_key" placeholder="api_key" />
	<input type="text" name="api_secret" id="api_secret" placeholder="api_secret" />
	<input type="button" name="faceppBtn" id="faceppBtn" value="Fetch detail fron Face++" />
</div>
<div id="info"></div>

<div id="container">
	<div id="img_home">
		<img id="img"/>
		<canvas id="canvas"></canvas>
		<div id="img_overlay"></div>
		<span id="tooltip-span"></span>
	</div>
	
	<div class="sidebar">
		<textarea id="actualData" ></textarea>
		<input type="button" id="plotActualBtn" value="Plot on Image" />
	</div>
</div>
<div class="clear"></div>
	<b>Dimentions :</b> <span id="imgdimentions"></span>
	<input type="button" id="clrPointsBtn" value="Clear all points" />
<script>

	//Display image from the URL or file path
	$('#imgUrlBtn').on('click', function() {
	    $('#img').attr('src',  $('#image_url').val());
	});

	$('#clrPointsBtn').on('click', function() {
	    deleteAllPoints();
	});

	$('#plotActualBtn').on('click', function() {
		deleteAllPoints();
	    actualData = JSON.parse($("#actualData").val());
	    alteredData = JSON.parse($("#actualData").val());
	    plotWith(actualData);
	});

	$('#img').on('load',function(){
	    $("#imgdimentions").text($('#img').width() + "," + $('#img').height());
	    $("#img_overlay").width($("#img").width());
		$("#img_overlay").height($("#img").height());
	});

	//To display conrdinates
    $("#img_overlay").mousemove(function(event) {
        var cordinates = getCordinates(event,this);
        $("#tooltip-span").css({"left" : cordinates.x + 15 + "px", "top" : cordinates.y + 15 + "px"});
        $("#tooltip-span").html("x:" + cordinates.x + "<br> y:" + cordinates.y);
    });

    //To create new point
    $("#img_overlay").mousedown(function (ev) {
        var cordinates = getCordinates(ev,this);
        confirm(cordinates);
    })


    $("#plotApiBtn").click(function(){
    	if(faces.length > 0){
    		faces.forEach(function(face){
    			drawPoints(face);
    		})
    	}else{
    		$("#info").text("No face to draw!!");
    	}

    });

    $("#faceppBtn").click(function(){
    	fetch();
    });

    function getCordinates(event, element){
		var x = event.pageX + $("#img_home").scrollLeft() - $("#img_home").get(0).offsetLeft - element.offsetLeft;
        var y = event.pageY + $("#img_home").scrollTop() - $("#img_home").get(0).offsetTop - element.offsetTop;
        return {x:x,y:y};
    }

	/* 	To show the image*/
	function readURL(input) {
		console.log("show image")
        if (input.files && input.files[0]) {
            var reader = new FileReader();

            reader.onload = function (e) {
                $('#img').attr('src', e.target.result)
            };

            reader.readAsDataURL(input.files[0]);
        }
    }

</script>

</body>
</html>